<script>
window.exportCSV = () => {
  if (!books.length) {
    alert("エクスポートするデータがありません");
    return;
  }

  const header = [
    "管理番号",
    "ISBN",
    "タイトル",
    "著者",
    "表紙URL",
    "登録日"
  ];

  const rows = books.map(b => [
    b.mcNumber || "",
    b.isbn || "",
    b.title || "",
    b.author || "",
    b.cover || "",
    b.createdAt?.toDate
      ? b.createdAt.toDate().toISOString().slice(0,10)
      : ""
  ]);

  const csv = [header, ...rows]
    .map(r => r.map(v => `"${String(v).replace(/"/g,'""')}"`).join(","))
    .join("\n");

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `books_${new Date().toISOString().slice(0,10)}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
};
</script>
